extends layout

block css
    style.
        .floor_plan_element {
            position: absolute;
            top: 0;
            left: 0;
        }

block content
    div(class='container')
        div(class="page-header")
            h1 一般偵測
        h2 平面圖
        div(class="text-center")
            div(style="position: relative; display: inline-block")
                img(id="floor_plan" src="/images/floor_plan.png" class="img-responsive")
                div(id="room0" class="floor_plan_element" style="height: 202px; width: 402px; background-color: rgba(0, 255, 0, 0.5)")
                div(id="room1" class="floor_plan_element" style="height: 149px; width: 198px; background-color: rgba(0, 255, 0, 0.5)")
        h2 偵測器資料&nbsp;
            small (更新頻率：5秒)
        h3 溫度
            div(id="chart_temperature")
        h3 濕度
            div(id="chart_humidity")
        h3 瓦斯
            div(id="chart_gas")
        h3 CO
            div(id="chart_co")

block javascript
    script(type="text/javascript" src="https://www.gstatic.com/charts/loader.js")
    script(type="text/javascript").
        $(resizeRoom);

        $(function () {
            // Load the Visualization API and the corechart package.
            google.charts.load('current', {'packages': ['corechart']});

            // Set a callback to run when the Google Visualization API is loaded.
            google.charts.setOnLoadCallback(function () {
                drawLineChart(!{JSON.stringify(data_temperature)}, 'chart_temperature');
                drawLineChart(!{JSON.stringify(data_humidity)}, 'chart_humidity');
                drawLineChart(!{JSON.stringify(data_gas)}, 'chart_gas');
                drawLineChart(!{JSON.stringify(data_co)}, 'chart_co');
            });
        });

        function drawLineChart(data, div_name) {
            var data = google.visualization.arrayToDataTable(data);

            var options = {
                curveType: 'function',
                legend: {position: 'none'}
            };

            var chart = new google.visualization.LineChart(document.getElementById(div_name));

            chart.draw(data, options);
        }

        $(window).resize(resizeRoom);

        function resizeRoom() {
            var $floorPlan = $('#floor_plan');
            var scale = $floorPlan.width() / $floorPlan[0].naturalWidth;
            var size = [
                {x: 51 + 201, y: 201 + 101},
                {x: 51 + 99, y: 50 + 74.5}
            ];

            for (var i = 0; i < 2; i++) {
                var transform =
                        "translate(-50%, -50%)" +
                        "scale(" + scale + ")" +
                        "translate(" + size[i].x + "px," + size[i].y + "px)";

                $('#room' + i).css({
                    '-ms-transform': transform,
                    '-webkit-transform': transform,
                    '-moz-transform': transform,
                    '-o-transform': transform,
                    'transform': transform
                });
            }

        }